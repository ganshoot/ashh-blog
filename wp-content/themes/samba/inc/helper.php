<?php
//FONTS
    $select_font_options = array(
        '9' => array(
            'value' =>  'Acme',
            'hosted'=> 'google',
            'css' => 'Acme',
            'label' => __( 'Acme', 'samba_lang' )
        ),
        '4' => array(
            'value' =>  'Alegreya:400italic,700italic,400,700',
            'hosted'=> 'google',
            'css' => 'Alegreya',
            'label' => __( 'Alegreya', 'samba_lang' )
        ),
        '16' => array(
            'value' =>  'Anton',
            'hosted'=> 'google',
            'css' => "'Anton', sans-serif",
            'label' => __( 'Anton', 'samba_lang' )
        ),
        '14' => array(
            'value' =>  'Arial',
            'hosted'=> 'self',
            'css' => 'Arial',
            'label' => __( 'Arial', 'samba_lang' )
        ),
        '5' => array(
            'value' =>  'Arvo',
            'hosted'=> 'google',
            'css' => 'Arvo',
            'label' => __( 'Arvo', 'samba_lang' )
        ),
        '10' => array(
            'value' =>  'Asap',
            'hosted'=> 'google',
            'css' => 'Asap',
            'label' => __( 'Asap', 'samba_lang' )
        ),
        '7' => array(
            'value' =>  'Asul:400,700',
            'hosted'=> 'google',
            'css' => 'Asul',
            'label' => __( 'Asul', 'samba_lang' )
        ),
        '43' => array(
            'value' =>  'Average+Sans',
            'hosted'=> 'google',
            'css' => "'Average Sans', sans-serif;",
            'label' => __( 'Average Sans', 'samba_lang' )
        ),
        '42' => array(
            'value' =>  'Bitter:400,700,400italic',
            'hosted'=> 'google',
            'css' => "'Bitter', serif;",
            'label' => __( 'Bitter', 'samba_lang' )
        ),
        '25' => array(
            'value' =>  'Bree+Serif',
            'hosted'=> 'google',
            'css' => "'Bree Serif', serif",
            'label' => __( 'Bree Serif', 'samba_lang' )
        ),
        '11' => array(
            'value' =>  'Cabin:400,600,700',
            'hosted'=> 'google',
            'css' => "'Cabin', sans-serif",
            'label' => __( 'Cabin', 'samba_lang' )
        ),
        '48' => array(
            'value' =>  'Changa+One:400,400italic',
            'hosted'=> 'google',
            'css' => "'Changa One', cursive;",
            'label' => __( 'Changa One', 'samba_lang' )
        ),
        '61' => array(
            'value' =>  'Cinzel:400,700,900',
            'hosted'=> 'google',
            'css' => "'Cinzel', serif;",
            'label' => __( 'Cinzel', 'samba_lang' )
        ),
        '29' => array(
            'value' =>  'courier_new',
            'hosted'=> 'self',
            'css' => "'Courier New', Courier, monospace",
            'label' => __( 'Courier New', 'samba_lang' )
        ),
        '24' => array(
            'value' =>  'Cousine:400,700',
            'hosted'=> 'google',
            'css' => "'Cousine', sans-serif",
            'label' => __( 'Cousine', 'samba_lang' )
        ),
        '51' => array(
            'value' =>  'Coustard',
            'hosted'=> 'google',
            'css' => "'Coustard', serif;",
            'label' => __( 'Coustard', 'samba_lang' )
        ),
        '56' => array(
            'value' =>  'Crimson+Text:400,400italic,600,600italic',
            'hosted'=> 'google',
            'css' => "'Crimson Text', serif;",
            'label' => __( 'Crimson Text', 'samba_lang' )
        ),
        '22' => array(
            'value' =>  'Dosis:400,500,600,700',
            'hosted'=> 'google',
            'css' => "'Dosis', sans-serif",
            'label' => __( 'Dosis', 'samba_lang' )
        ),
        '1' => array(
            'value' =>  'Droid+Sans:400,700',
            'css' => 'Droid Sans',
            'hosted'=> 'google',
            'label' => __( 'Droid Sans', 'samba_lang' )
        ),
        '8' => array(
            'value' =>  'Droid+Serif:400,700,400italic,700italic',
            'css' => 'Droid Serif',
            'hosted'=> 'google',
            'label' => __( 'Droid Serif', 'samba_lang' )
        ),
        '18' => array(
            'value' =>  'Economica:700',
            'hosted'=> 'google',
            'css' => "'Economica', sans-serif",
            'label' => __( 'Economica', 'samba_lang' )
        ),
        '17' => array(
            'value' =>  'Exo:700,800',
            'hosted'=> 'google',
            'css' => "'Exo', sans-serif",
            'label' => __( 'Exo Sans', 'samba_lang' )
        ),
        '15' => array(
            'value' =>  'Francois+One',
            'hosted'=> 'google',
            'css' => "'Francois One', sans-serif",
            'label' => __( 'Francois One', 'samba_lang' )
        ),
        '30' => array(
            'value' =>  'helvetica',
            'hosted'=> 'self',
            'css' => "Helvetica, arial, sans-serif",
            'label' => __( 'Helvetica', 'samba_lang' )
        ),
        '52' => array(
            'value' =>  'Josefin+Sans:400,600,700',
            'hosted'=> 'google',
            'css' => "'Josefin Sans', sans-serif",
            'label' => __( 'Josefin Sans', 'samba_lang' )
        ),
        '26' => array(
            'value' =>  'Lato:300,400,700',
            'hosted'=> 'google',
            'css' => "'Lato', sans-serif",
            'label' => __( 'Lato', 'samba_lang' )
        ),
        '59' => array(
            'value' =>  'Lekton:400,700,400italic&subset=latin,latin-ext',
            'hosted'=> 'google',
            'css' => "'Lekton', sans-serif",
            'label' => __( 'Lekton', 'samba_lang' )
        ),
        '32' => array(
            'value' =>  'Lora',
            'hosted'=> 'google',
            'css' => "'Lora', serif",
            'label' => __( 'Lora', 'samba_lang' )
        ),
        '46' => array(
            'value' =>  'Maven+Pro:400,700',
            'hosted'=> 'google',
            'css' => "'Maven Pro', sans-serif",
            'label' => __( 'Maven Pro', 'samba_lang' )
        ),
        '54' => array(
            'value' =>  'Merriweather:400,300,700',
            'hosted'=> 'google',
            'css' => "'Merriweather', serif",
            'label' => __( 'Merriweather', 'samba_lang' )
        ),
        '31' => array(
            'value' =>  'Montserrat',
            'hosted'=> 'google',
            'css' => "'Montserrat', sans-serif",
            'label' => __( 'Montserrat', 'samba_lang' )
        ),
        '37' => array(
            'value' =>  'Muli:400,400italic',
            'hosted'=> 'google',
            'css' => "'Muli', sans-serif",
            'label' => __( 'Muli', 'samba_lang' )
        ),
        '50' => array(
            'value' =>  'News+Cycle:400,700',
            'hosted'=> 'google',
            'css' => "'News Cycle', sans-serif",
            'label' => __( 'News Cycle', 'samba_lang' )
        ),
        '60' => array(
            'value' =>  'Nobile:400,400italic,700,700italic',
            'hosted'=> 'google',
            'css' => "'Nobile', sans-serif",
            'label' => __( 'Nobile', 'samba_lang' )
        ),
        '0' => array(
            'value' =>  'Open+Sans:400italic,600italic,700italic,400,600,700',
            'css' => 'Open Sans',
            'hosted'=> 'google',
            'label' => __( 'Open Sans', 'samba_lang' )
        ),
        '47' => array(
            'value' =>  'Open+Sans+Condensed:300,700,300italic',
            'hosted'=> 'google',
            'css' => "'Open Sans Condensed', sans-serif",
            'label' => __( 'Open Sans Condensed', 'samba_lang' )
        ),
        '45' => array(
            'value' =>  'Orienta',
            'hosted'=> 'google',
            'css' => "'Orienta', sans-serif",
            'label' => __( 'Orienta', 'samba_lang' )
        ),
        '13' => array(
            'value' =>  'Oswald:700,400,300',
            'hosted'=> 'google',
            'css' => "'Oswald', sans-serif",
            'label' => __( 'Oswald', 'samba_lang' )
        ),
        '36' => array(
            'value' =>  'Overlock+SC',
            'hosted'=> 'google',
            'css' => "'Overlock SC', cursive",
            'label' => __( 'Overlock SC', 'samba_lang' )
        ),
        '33' => array(
            'value' =>  'Oxygen+Mono',
            'hosted'=> 'google',
            'css' => "'Oxygen Mono', sans-serif",
            'label' => __( 'Oxygen Mono', 'samba_lang' )
        ),
        '41' => array(
            'value' =>  'Patua+One',
            'hosted'=> 'google',
            'css' => "'Patua One', cursive",
            'label' => __( 'Patua One', 'samba_lang' )
        ),
        '39' => array(
            'value' =>  'Pompiere',
            'hosted'=> 'google',
            'css' => "'Pompiere', cursive",
            'label' => __( 'Pompiere', 'samba_lang' )
        ),
        '2' => array(
            'value' =>  'PT+Sans:400,700,400italic,700italic',
            'hosted'=> 'google',
            'css' => "'PT Sans', sans-serif",
            'label' => __( 'PT Sans', 'samba_lang' )
        ),
        '28' => array(
            'value' =>  'PT+Sans+Narrow',
            'hosted'=> 'google',
            'css' => "'PT Sans Narrow', sans-serif",
            'label' => __( 'PT Sans Narrow', 'samba_lang' )
        ),
        '23' => array(
            'value' =>  'Questrial',
            'hosted'=> 'google',
            'css' => "'Questrial', sans-serif",
            'label' => __( 'Questrial', 'samba_lang' )
        ),
        '35' => array(
            'value' =>  'Quicksand:400,700',
            'hosted'=> 'google',
            'css' => "'Quicksand', sans-serif",
            'label' => __( 'Quicksand', 'samba_lang' )
        ),
        '34' => array(
            'value' =>  'Raleway:400,700',
            'hosted'=> 'google',
            'css' => "'Raleway', sans-serif",
            'label' => __( 'Raleway', 'samba_lang' )
        ),
        '57' => array(
            'value' =>  'Rambla:400,700,400italic,700italic&subset=latin,latin-ext',
            'hosted'=> 'google',
            'css' => "'Rambla', sans-serif",
            'label' => __( 'Rambla', 'samba_lang' )
        ),
        '55' => array(
            'value' =>  'Roboto+Condensed:400italic,700italic,400,700&subset=latin,latin-ext',
            'hosted'=> 'google',
            'css' => "'Roboto Condensed', sans-serif",
            'label' => __( 'Roboto Condensed', 'samba_lang' )
        ),
        '53' => array(
            'value' =>  'Rokkitt:400,700',
            'hosted'=> 'google',
            'css' => "'Rokkitt', serif",
            'label' => __( 'Rokkit', 'samba_lang' )
        ),
        '12' => array(
            'value' =>  'Ruda:400,700,900',
            'hosted'=> 'google',
            'css' => "'Ruda', sans-serif",
            'label' => __( 'Ruda', 'samba_lang' )
        ),
        '38' => array(
            'value' =>  'Rye',
            'hosted'=> 'google',
            'css' => "'Rye', cursive",
            'label' => __( 'Rye', 'samba_lang' )
        ),
        '58' => array(
            'value' =>  'Sanchez:400italic,400&subset=latin,latin-ext',
            'hosted'=> 'google',
            'css' => "'Sanchez', serif",
            'label' => __( 'Sanchez', 'samba_lang' )
        ),
        '44' => array(
            'value' =>  'Share+Tech',
            'hosted'=> 'google',
            'css' => "'Share Tech', sans-serif",
            'label' => __( 'Share Tech', 'samba_lang' )
        ),
        '49' => array(
            'value' =>  'Source+Sans+Pro:400,700,400italic,700italic',
            'hosted'=> 'google',
            'css' => "'Source Sans Pro', sans-serif",
            'label' => __( 'Source Sans Pro', 'samba_lang' )
        ),
        '40' => array(
            'value' =>  'Titillium+Web:400,400italic,600,700,700italic',
            'hosted'=> 'google',
            'css' => "'Titillium Web', sans-serif",
            'label' => __( 'Titillium Web', 'samba_lang' )
        ),
        '6' => array(
            'value' =>  'Ubuntu:400,400italic',
            'hosted'=> 'google',
            'css' => "'Ubuntu', sans-serif",
            'label' => __( 'Ubuntu', 'samba_lang' )
        ),
        '27' => array(
            'value' =>  'Vollkorn:400italic,400',
            'hosted'=> 'google',
            'css' => "'Vollkorn', serif",
            'label' => __( 'Vollkorn', 'samba_lang' )
        ),
        '3' => array(
            'value' =>  'Yanone+Kaffeesatz',
            'hosted'=> 'google',
            'css' => 'Yanone Kaffeesatz',
            'label' => __( 'Yanone Kaffeesatz', 'samba_lang' )
        ),
        '190' => array(
            'value' =>  'bebas_neue',
            'hosted'=> 'theme',
            'css' => "BebasNeueRegular",
            'label' => __( 'Bebas Neue', 'samba_lang' )
        ),
        '191' => array(
            'value' =>  'league_gothic',
            'hosted'=> 'theme',
            'css' => "LeagueGothicRegular",
            'label' => __( 'League Gothic', 'samba_lang' )
        ),
        '194' => array(
            'value' =>  'novecento',
            'hosted'=> 'theme',
            'css' => "NovecentowideBookBold",
            'label' => __( 'Novecento', 'samba_lang' )
        ),
        '192' => array(
            'value' =>  'osp_din',
            'hosted'=> 'theme',
            'css' => "OSPDIN",
            'label' => __( 'OSP Din', 'samba_lang' )
        ),
        '193' => array(
            'value' =>  'tex_gyre',
            'hosted'=> 'theme',
            'css' => "TeXGyreHerosBold",
            'label' => __( 'TeX Gyre Heros', 'samba_lang' )
        )
    );
    
    $prk_samba_frontend_options=get_option('samba_theme_options');
    //MAKE THE THEME READY FOR EXTRA FONTS PLUGIN
    if (!is_array($prk_samba_frontend_options['header_font']))
    {

        foreach ( $select_font_options as $option_header ) 
        {
            $label_header = $option_header['label'];
            if ($prk_samba_frontend_options['header_font'] == $option_header['value'])
            {
                $prk_samba_frontend_options['header_font']=$option_header;
            }  
        }
        if (is_plugin_active('prk_fonts/prk_fonts.php'))
        {
            $prk_font_options = get_option('prk_font_plugin_option');
            foreach ($prk_font_options as $font) {
                if ($font['erased']=="false") {
                    if ($prk_samba_frontend_options['header_font'] == $font['value'])
                    {
                        $prk_samba_frontend_options['header_font']=$font;
                    } 
                }
            }
        }
        update_option('samba_theme_options', $prk_samba_frontend_options);
    }
    if (!is_array($prk_samba_frontend_options['body_font']))
    {
        foreach ( $select_font_options as $option_header ) 
        {
            $label_header = $option_header['label'];
            if ($prk_samba_frontend_options['body_font'] == $option_header['value'])
            {
                $prk_samba_frontend_options['body_font']=$option_header;
            }  
        }
        if (is_plugin_active('prk_fonts/prk_fonts.php'))
        {
            $prk_font_options = get_option('prk_font_plugin_option');
            foreach ($prk_font_options as $font) {
                if ($font['erased']=="false") {
                    if ($prk_samba_frontend_options['body_font'] == $font['value'])
                    {
                        $prk_samba_frontend_options['body_font']=$font;
                    } 
                }
            }
        }
        update_option('samba_theme_options', $prk_samba_frontend_options);
    }
    function samba_scripts() 
    {
        if (function_exists('wp_get_theme'))
            $prk_theme = wp_get_theme();
        else
        {
            $prk_theme->Version="1";
        }
        $prk_samba_frontend_options=get_option('samba_theme_options');
        
        wp_enqueue_style('samba_custom_style', get_template_directory_uri() . '/css/custom.css', false, $prk_theme->Version);
        wp_enqueue_style('samba_other_styles', get_template_directory_uri() . '/css/other.css', false, $prk_theme->Version);
        if ($prk_samba_frontend_options['responsive']=="true") 
        {
            wp_enqueue_style('pirenko_responsive_style', get_template_directory_uri() . '/css/responsive.css', false, $prk_theme->Version);
        }
        if (is_child_theme())
        {
            wp_enqueue_style('samba_child_styles', get_stylesheet_directory_uri() . '/style.css', false, $prk_theme->Version);
        }
        //OVERRIDE OPTIONS - ONLY FOR PREVIEW MODE
        if (INJECT_STYLE)
        {
            include(ABSPATH . 'wp-content/plugins/color-manager-samba/style_header.php');
        }
        if (is_single() && comments_open() && get_option('thread_comments')) 
        {
            wp_enqueue_script('comment-reply');
        }
    
        wp_register_script('samba_main', get_template_directory_uri() . '/js/main.js', array('jquery'), $prk_theme->Version, true);
        wp_register_script('samba_other', get_template_directory_uri() . '/js/other.js', array('jquery'), $prk_theme->Version, true);

        wp_enqueue_script('samba_main');
        wp_enqueue_script('samba_other');

        wp_localize_script('samba_main', 'ajax_var', array(
            'url' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('ajax-nonce'),
        ));

        global $prk_bk_url;
         global $prk_back_css;
        $prk_bk_url= $prk_samba_frontend_options['background_image'];
        $prk_back_css="";
        if ($prk_samba_frontend_options['background_image']!="")
        {
            $prk_back_css.='<img id="full-screen-background-image" />';
        }
        global $prk_portfolio_link;
        $prk_portfolio_link="";
        $prk_blog_linked="";
        if ((is_single() && get_post_type()=="post") || (is_archive() && (PRK_WOO=="false" || (PRK_WOO=="true" && !is_woocommerce()) )))
        {
            $prk_blog_linked=get_page_link(prk_get_parent_blog());
        }
        if (get_post_type()=="pirenko_portfolios")
        {
            $prk_portfolio_link=get_page_link(prk_get_parent_portfolio());
        }
        $home_link="";
        $home_slug="";
        if (is_page_template ('template_blog.php') && is_front_page())
        {
            $home_link=get_page_link(get_query_var('page_id'));
            $home_slug=the_slug(get_query_var('page_id'));
        }
        if ($prk_portfolio_link!="")
            $prk_blog_linked="";
        $custom_opacity=floatval($prk_samba_frontend_options['custom_opacity']/100);
        $custom_opacity_folio=floatval($prk_samba_frontend_options['custom_opacity_folio']/100);
        if (!isset($prk_samba_frontend_options['custom_shadow']))
            $prk_samba_frontend_options['custom_shadow']=0;
        $custom_shadow=floatval($prk_samba_frontend_options['custom_shadow']/100);      
        
        //INCLUDE SCRIPT FROM WORDPRESS CORE
        wp_enqueue_script('jquery-ui-accordion');
        wp_enqueue_script('jquery-ui-tabs');
        wp_enqueue_script('jquery-ui-button');

        //GOOGLE
        $protocol = is_ssl() ? 'https' : 'http';
        if ($prk_samba_frontend_options['header_font']['hosted']=='google')
        {
            wp_enqueue_style( 'prk_header_font', "$protocol://fonts.googleapis.com/css?family=".$prk_samba_frontend_options['header_font']['value'] );
        }
        if ($prk_samba_frontend_options['header_font']['hosted']=='theme')
        {
                wp_enqueue_style( 'prk_header_font', get_template_directory_uri() . '/inc/fonts/'.$prk_samba_frontend_options['header_font']['value'].'/stylesheet.css',false,$prk_theme->Version);
        }
        if ($prk_samba_frontend_options['header_font']['hosted']=='plugin')
        {
                wp_enqueue_style( 'prk_header_font', $prk_samba_frontend_options['header_font']['value'],false,$prk_theme->Version);
        }
        if ($prk_samba_frontend_options['body_font']['hosted']=='google')
        {
            wp_enqueue_style( 'prk_body_font', "$protocol://fonts.googleapis.com/css?family=".$prk_samba_frontend_options['body_font']['value'] );
        }
        if ($prk_samba_frontend_options['body_font']['hosted']=='theme')
        {
            wp_enqueue_style( 'prk_body_font', get_template_directory_uri() . '/inc/fonts/'.$prk_samba_frontend_options['body_font']['value'].'/stylesheet.css',false,$prk_theme->Version);
        }
        if ($prk_samba_frontend_options['body_font']['hosted']=='plugin')
        {
                wp_enqueue_style( 'prk_body_font', $prk_samba_frontend_options['body_font']['value'],false,$prk_theme->Version);
        }

        $woo_link="";
        $woo_link_for_cart="";
        //PLACE WOOCOMMERCE IF NEEDED
        if (PRK_WOO=="true") {
            wp_enqueue_style('css_woocommerce', get_template_directory_uri() . '/css/woocommerce.css');
            $woo_colors = array_map( 'esc_attr', (array) get_option( 'woocommerce_frontend_css_colors' ) );
            if ($prk_samba_frontend_options['woo_cart_display']=="cart") 
            {
                $woo_link_for_cart=get_page_link(woocommerce_get_page_id('cart'));
            }
            else
            {
                $woo_link_for_cart=get_page_link(woocommerce_get_page_id('shop'));
            }
            if (is_woocommerce() || is_cart() || is_checkout() || is_order_received_page()) {
                $woo_link=get_page_link(woocommerce_get_page_id('shop'));
            }
        }
        if ( !isset($woo_colors['primary']) ) 
            $woo_colors['primary'] = '';
        if (PRK_SAMBA_ON=="true") {
            $sharrre_dir_prk=plugins_url("samba_framework");
        }
        else {
            $sharrre_dir_prk="";
        }
        if ($prk_samba_frontend_options['responsive_width']<769){
            $prk_samba_frontend_options['responsive_width']=769;
        }
        wp_localize_script('samba_main', 'theme_options', array(
            'ajax_calls' => $prk_samba_frontend_options['ajax_calls'],
            'responsive_width' => $prk_samba_frontend_options['responsive_width'],
            'bk_url' => $prk_bk_url,
            'custom_opacity' => $custom_opacity,
            'custom_opacity_folio' => $custom_opacity_folio,
            'portfolio_link' => $prk_portfolio_link,
            'blog_link' => $prk_blog_linked,
            'home_link' => $home_link,
            'home_slug' => $home_slug,
            'active_color' => $prk_samba_frontend_options['active_color'],
            'inactive_color' => $prk_samba_frontend_options['inactive_color'],
            'menu_up_color' => $prk_samba_frontend_options['menu_up_color'],
            'submenu_color' => $prk_samba_frontend_options['submenu_color'],
            'background_color_btns' => $prk_samba_frontend_options['background_color_btns'],
            'background_color_btns_blog' => $prk_samba_frontend_options['background_color_btns_blog'],
            'menu_active_color' => $prk_samba_frontend_options['menu_active_color'],
            'site_background_color' => $prk_samba_frontend_options['site_background_color'],
            'background_color' => $prk_samba_frontend_options['background_color'],
            'bd_headings_color' => $prk_samba_frontend_options['bd_headings_color'],
            'menu_subheadings_color' => $prk_samba_frontend_options['menu_subheadings_color'],
            'titles_color_footer' => $prk_samba_frontend_options['titles_color_footer'],
            'delay_portfolio' => $prk_samba_frontend_options['delay_portfolio'],
            'resp_mode' => $prk_samba_frontend_options['responsive'],
            'sharrre_dir_prk' => $sharrre_dir_prk,
            'share_text' => $prk_samba_frontend_options['share_text'],
            'theme_buttons_color' => $prk_samba_frontend_options['theme_buttons_color'],
            'buttons_color' => $prk_samba_frontend_options['buttons_color'],
            'woo_color' => $woo_colors['primary'],
            'woo_link_for_cart' => $woo_link_for_cart,
            'woo_link' => $woo_link,
            'use_custom_colors' => $prk_samba_frontend_options['use_custom_colors'],
            'active_woocommerce' => PRK_WOO,
            'active_visual_composer' => PRK_COMPOSER
            
        ));
        
        $options = get_option('samba_theme_options');
        //OVERRIDE OPTIONS - ONLY FOR PREVIEW MODE
        if (INJECT_STYLE)
        {
            include(ABSPATH . 'wp-content/plugins/color-manager-samba/style.php');  
        }
        $active_color = $options['active_color'];
        $inactive_color = $options['inactive_color'];
        $menu_up_color = $options['menu_up_color'];
        $menu_active_color=$options['menu_active_color'];
        $bd_headings_color = $options['bd_headings_color'];
        $background_color = $options['background_color'];
        $background_color_header = $options['background_color_header'];
        $submenu_color = $options['submenu_color'];
        $site_background_color = $options['site_background_color'];
        if ($options['background_color_btns']!="")
        {
            $background_color_btns=$options['background_color_btns'];
            $splitted_background_color_btns=html2rgb($background_color_btns);
        }
        else
            $background_color_btns="empty";
        $background_color_btns_blog=$options['background_color_btns_blog'];
        $shadow_color=$options['shadow_color'];
        $lines_color=$options['lines_color'];
        $body_color_footer = $options['body_color_footer'];
        $custom_opacity=floatval($options['custom_opacity']/100);
        $custom_opacity_folio=floatval($options['custom_opacity_folio']/100);
        $custom_shadow=floatval($options['custom_shadow']/100);
        if (!isset($options['custom_menu_opacity'])) {
            $options['custom_menu_opacity']=100;
        }
        $custom_menu_opacity=floatval($options['custom_menu_opacity']/100);
        

        $splitted_active_color= html2rgb($active_color);
        $splitted_menu_up_color= html2rgb($menu_up_color);
        $splitted_background_color=html2rgb($background_color);
        $splitted_site_background_color=html2rgb($site_background_color);
        $splitted_background_color_btns_blog=html2rgb($background_color_btns_blog);
        $splitted_bd_headings_color = html2rgb($bd_headings_color);
        $splitted_inactive_color=html2rgb($inactive_color);
        $splitted_shadow_color=html2rgb($shadow_color);
        $splitted_lines_color=html2rgb($lines_color);
        $splitted_background_color_header=html2rgb($background_color_header);
        if ($submenu_color!="")
        {
            $splitted_submenu_color = html2rgb($submenu_color);
        }
        $splitted_menu_active_color = html2rgb($options['menu_active_color']);
        
        //START BUILDING CSS SENTENCE TO CUSTOMIZE CONTENT
        $css = "";
        //ADD CUSTOM CSS
        //ADJUT LOGO POSITION
        $css .= "#logo_holder
                {
                    margin-top:" .$options['menu_vertical']. "px;
                    margin-bottom:" .$options['menu_vertical']. "px;
                }
                ";
        $css .= "body,
                .search-query,
                .regular_font,
                input,
                textarea
                {
                    font-family:".$options['body_font']['css'].";
                }
                .woocommerce a.button:hover, 
                .woocommerce button.button:hover, 
                .woocommerce input.button:hover, 
                .woocommerce #respond input#submit:hover,  
                .woocommerce #content input.button:hover, 
                .woocommerce-page a.button:hover, 
                .woocommerce-page button.button:hover, 
                .woocommerce-page input.button:hover, 
                .woocommerce a.button, 
                .woocommerce button.button, 
                .woocommerce input.button, 
                .woocommerce #respond input#submit, 
                .woocommerce #content input.button, 
                .woocommerce-page a.button, 
                .woocommerce-page button.button, 
                .woocommerce-page input.button,
                .woocommerce-page #respond input#submit, 
                .woocommerce-page #content input.button,
                .comments_slider .comment-link,
                .comments_slider .comment-author,
                .wpb_accordion .wpb_accordion_wrapper .wpb_accordion_header,
                .wpb_tabs_nav a,
                .theme_button,
                .theme_button_inverted,
                .theme_button input,
                .theme_button_inverted input,
                .prk_composer_title,
                .wpb_button,
                .wpb_heading,
                .wpb_wrapper h2,
                .header_font,
                .nav,
                #nav_footer,
                .sf-menu,
                .day,
                .month,
                .theme_tags,
                .homepage-header,
                .sidebar_bubble,
                .related_single_title,
                .widget-title,
                .masonr_title,
                .masonr_date,
                .entry_title_single,
                .search_rs_ttl,
                .headings_top,
                .post_meta_single .after_icon,
                .post_meta_single .bf_icon,
                .prevnext_single .after_icon,
                .prevnext_single .bf_icon,
                header_font,
                .pir_divider_cats,
                .shortcode-title,
                #single_post_teaser,
                #nav-main.resp_mode li > a,
                #single_portfolio_meta .single_heading,
                .type-post .prevnext_single,
                #single_page_teaser,
                #pir_categories {
                    font-family:".$options['header_font']['css'].";
                }
                ";
        //UPPERCASE
        if ($options['uppercase_titles']=="yes") {
            $css .= "   #blog_ttl,
                        .author_info h4,
                        .prk_titlify_father h3,
                        .prk_titlify_father .widget-title,
                        .entry_title_single h4 {
                            text-transform:uppercase;
            }";
        }
        //WIDTH SET MANAGEMENT
        $css .= ".prk_inner_block {
            max-width: ".$options['custom_width']."px;
        }";
        global $retina_device;
        global $post;
        //SET THE BODY COLOR
        $css .=
        "body {
            background-color:".$options['site_background_color']."; 
        }
        ";
        if ($options['pattern']!="")
        {
            if ($retina_device=="prk_retina")
            {
                $path_parts = pathinfo(get_template_directory_uri()."/images/patterns/".$options['pattern'] );
                $vt_image = vt_resize( '', get_template_directory_uri() . "/images/patterns/".$path_parts['filename']."_@2X.".$path_parts['extension'] , 2000, 2000, false );
                $half_width=$vt_image['width']/2;
                $css .=
                "body {
                    background: url(" . get_template_directory_uri() . "/images/patterns/".$path_parts['filename']."_@2X.".$path_parts['extension'].") fixed;
                    background-size:".$half_width."px auto;
                }";
            }
            else
            {
                $css .=
                "body {
                    background: url(" . get_template_directory_uri() . "/images/patterns/".$options['pattern'].") fixed;
                }";
            }
        }
        //COLOR MANAGEMENT
        $woo_colors = array_map( 'esc_attr', (array) get_option( 'woocommerce_frontend_css_colors' ) );
        if ( isset($woo_colors['primary']) ) 
        {
            $css .=
            "a.added_to_cart,
            a.added_to_cart:hover,
            .terms a,
            .terms a:hover {
                color:".$woo_colors['primary'].";   
            }
            ";
        }
        if ( $background_color_btns!="empty" ) 
        {
            $css .=
            ".member_colored_block_in,
            .grid_colored_block,
            .related_fader_grid {
                background-color:$background_color_btns;
                background-color: rgba($splitted_background_color_btns[0], $splitted_background_color_btns[1], $splitted_background_color_btns[2], ".$custom_opacity_folio.");
            }
            ";
        }
        $css .= ".sf-menu li a,
                .sf-menu li .prk_btm_square,
                 .sf-menu li a:hover,
                 .prk_gallery_title {
                    color: $menu_up_color;
                }
                #prk_gallery_close,
                .prk_gallery_control {
                    background-color:$menu_up_color;
                }
                .pir_divider_menu {
                    border-right:1px dotted rgba($splitted_menu_up_color[0], $splitted_menu_up_color[1], $splitted_menu_up_color[2],0.3);
                }
                a,
                a:hover,
                #top_widgets h3,
                .home_blog_date_text h4,
                .contact_error,
                #top_widgets .email a:hover,
                h3 a:hover,
                .entry-title a:hover,
                #nav_footer .active a,
                #nav_footer a:hover,
                .blog_meta>p>a:hover,
                #blog_entries_masonr .blog_meta a:hover,
                #single_portfolio_meta .comments-link:hover,
                .blog_meta a.comments-link:hover,
                .blog_meta a:hover,
                #mini_menu a:hover,
                .post_meta_single a:hover,
                .entry_title_single .masonr_date>span,
                .post_meta_single #previous_button:hover .after_icon,
                .post_meta_single #next_button:hover .bf_icon,
                #nav-main.resp_mode li > a:hover,
                .a_colored a:hover,
                .recentposts_ul_shortcode .blog_meta a:hover,
                .classic_meta .post-categories li a:hover,
                .headings_top,
                .tiny_bullet,
                #back_to_top,
                #back_to_top-collapsed,
                .not_zero_color {
                    color: $active_color;
                }
                .tooltipster-light.inverted,
                .wpb_heading,
                .zero_color,
                .zero_color a,
                .header_font.zero_color a,
                a.zero_color,
                .zero_color a:hover,
                a.zero_color:hover {
                    color: $bd_headings_color;  
                }
                #after_widgets,
                #footer_in .default_color a,
                #footer_in {
                    color:$body_color_footer;
                }
                #footer_in a,
                #footer_in .theme_button a,
                .footer .widget-title {
                    color:".$options['titles_color_footer'].";
                }
                #footer_in .theme_button_inverted a:hover,
                #footer_in .theme_button a:hover {
                    color:".$options['titles_color_footer']." !important;
                }
                body,
                .prk_tags_ul a,
                .blog_meta>p>a,
                .flexslider .headings_body,
                .shortcode_slider .headings_body,
                .padded_text a,
                .post_meta_single .after_icon,
                .post_meta_single .bf_icon,
                .post_meta_single a,
                .blog_meta a,
                .default_color,
                .default_color a,
                .default_color a:hover,
                a.default_color,
                a.default_color:hover,
                .titled_block .grid_single_title span a,
                #no_more .prk_titlify,
                .single_entry_tags a,
                .contact_address_right_single a,
                #samba_search,
                .masonr_read_more a,
                .blog_meta a,
                #nav-main.resp_mode li > a,
                a.smoothed_a,
                .ui-tabs .ui-tabs-nav li a,
                .pirenko_highlighted,
                a.alt_smoothed_a,
                .scode_categories .filter li a,
                select {
                    color:$inactive_color;
                }
                ::-webkit-input-placeholder {
                   color: $inactive_color;
                }
                :-moz-placeholder { /* Firefox 18- */
                   color: $inactive_color;  
                }
                ::-moz-placeholder {  /* Firefox 19+ */
                   color: $inactive_color;  
                }
                :-ms-input-placeholder {  
                   color: $inactive_color;  
                }
                .sf-menu li li.before_nav_icon:before,
                .entry-title a,
                a.lk_text,
                .sidebar_bubble,
                a.lk_text:hover,
                .theme_tags li a,
                .theme_tags li a:hover,
                .related_post a,
                .prk_folio_control,
                .prk_price_featured,
                .menu_bk_color {
                    color:$background_color;
                }
                #contact-form textarea {  
                   color:$inactive_color;
                }
                .flex-prev,
                .flex-next,
                a.flex-prev:hover,
                a.flex-next:hover,
                #previous_button a,
                #previous_button a:hover,
                #next_button a,
                #next_button a:hover,
                .mini_arrow_up,
                .prevnext_single a,
                .bx-controls-direction a,
                .bx-controls-direction a:hover,
                #back_portfolio a,
                .prk_price_table.featured,
                .prk_price_table.featured .zero_color,
                .prk_price_table.featured .default_color,
                .tagcloud a,
                #pir_categories li a,
                #pir_categories li a:hover,
                .scode_categories li.active a,
                .scode_categories li.active a:hover,
                .tooltipster-light,
                .site_background_colored a,
                a.site_background_colored,
                .site_background_colored,
                .prk_blockquote.colored_background .in_quote,
                .prk_button_like,
                .body_bk_color,
                .blog_date,
                #prk_gallery_control_right,
                #prk_gallery_control_left,
                #no_more,
                .prk_sharrre_button a,
                .theme_button input,
                .theme_button a,
                .theme_button a:hover,
                .member_function,
                .theme_button_inverted a,
                .theme_button_inverted a:hover,
                #tp_side_close_icon .icon-up-open:before,
                #tp_side_icon .icon-down-open:before,
                .prk_progress_bar,
                .ui-accordion .ui-accordion-header,
                .ui-accordion .ui-accordion-header a,
                .ui-tabs .ui-tabs-nav li.ui-tabs-active a,
                .ui-tabs .ui-tabs-nav li.ui-state-hover a {
                    color:$site_background_color;
                }
                .flex-control-nav li a {
                    background-color: $site_background_color;
                }
                .flex-control-nav li a {
                    -webkit-box-shadow: 0px 0px 1px rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2], 0.75);
                    -mobox-shadow: 0px 0px 1px rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2], 0.75);
                    box-shadow: 0px 0px 1px rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2], 0.75);
                }
                .sf-menu > li > a {
                    text-shadow:0px 0px 1px rgba($splitted_menu_up_color[0], $splitted_menu_up_color[1], $splitted_menu_up_color[2],0.2);
                }
                #menu_section .mCSB_scrollTools .mCSB_draggerRail,
                #menu_section .sf-menu>li.active>a,
                #menu_section .sub-menu>li.active>a {
                    background-color:".$options['menu_subheadings_color'].";
                }
                #menu_section.under_logo,
                .opened_menu,
                #after_widgets {
                    border-top:1px solid ".$options['menu_lines_color'].";
                }
                .menu_active_colored,
                .sf-menu li.active>a {
                    color:$menu_active_color;
                }
                .bd_headings_text_shadow {
                    text-shadow:0px 0px 1px rgba($splitted_bd_headings_color[0], $splitted_bd_headings_color[1], $splitted_bd_headings_color[2],0.3);
                }
                .body_text_shadow {
                    text-shadow:0px 0px 1px rgba($splitted_inactive_color[0], $splitted_inactive_color[1], $splitted_inactive_color[2],0.2);
                }
                .flexslider .theme_button_inverted a,
                .navigation-previous,
                .navigation-next,
                .flex-direction-nav li a.flex-next,
                .flex-direction-nav li a.flex-prev {
                    background-color:".$options['buttons_color'].";
                }
                .prk_menu_block,
                #nprogress .bar,
                #pir_categories li.active a {
                    background-color:$site_background_color;
                }
                .prk_blockquote.colored_background .in_quote:after {
                    border-color: $site_background_color rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2],0.35) $site_background_color rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2],0.35);
                }
                #author_area.prk_blockquote.colored_background .in_quote:after {
                    border-color: $site_background_color rgba($splitted_inactive_color[0], $splitted_inactive_color[1], $splitted_inactive_color[2],0.15) $site_background_color rgba($splitted_inactive_color[0], $splitted_inactive_color[1], $splitted_inactive_color[2],0.15);
                }
                #menu_section.under_logo .sf-menu li a {
                    color:".$menu_up_color." !important;
                }
                .headings_top,
                .active_text_shadow {
                    text-shadow:0px 0px 1px rgba($splitted_active_color[0], $splitted_active_color[1], $splitted_active_color[2],0.3);
                }
                #footer_in input {
                    border: 1px solid ".$options['menu_lines_color'].";
                    color: $body_color_footer;
                }
                #footer_in input::-webkit-input-placeholder {
                   color: $body_color_footer;
                }
                #footer_in input:-moz-placeholder { /* Firefox 18- */
                   color: $body_color_footer;  
                }
                #footer_in input::-moz-placeholder {  /* Firefox 19+ */
                   color: $body_color_footer;  
                }
                #footer_in input:-ms-input-placeholder {  
                   color: $body_color_footer;
                }
                .commentlist li .comment-author img {
                    border:4px solid $site_background_color;
                }
                #prk_responsive_menu,
                #menu_section {
                    background-color:rgba($splitted_background_color_header[0], $splitted_background_color_header[1], $splitted_background_color_header[2],$custom_menu_opacity);
                }
                #top_bar_wrapper.at_top {
                    border-left:0px;
                }
                #top_bar_wrapper .post-like,
                .fifty_button {
                    border-right:1px solid $menu_active_color;
                    border-right: 1px solid rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2],0.5);
                }
                .prk_right_panel {
                    border-left:1px solid $menu_active_color;
                    border-left: 1px solid rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2],0.5);
                }
                .theme_button_inverted a {
                    background-color: ".$options['theme_buttons_color'].";
                }
                .tooltipster-light,
                #blog_entries .blog_date,
                .prk_price_table.featured .prk_price_header,
                #prk_gallery_control_right,
                #prk_gallery_control_left,
                .classic_meta .post-categories li a,
                .tagcloud a,
                .prk_sharrre_father,
                .prk_sharrre_button,
                #in_no_more {
                    background-color: $bd_headings_color;
                }
                .blog_fader_grid {
                    background-color:$background_color_btns_blog;
                    background-color: rgba($splitted_background_color_btns_blog[0], $splitted_background_color_btns_blog[1], $splitted_background_color_btns_blog[2], ".$custom_opacity.");
                }
                #menu_section .mCSB_scrollTools .mCSB_dragger .mCSB_dragger_bar,
                #top_bar_wrapper,
                .bx-controls-direction a,
                .prk_button_like,
                .theme_tags li.active,  
                .blog_icon,
                .inner_line_block,
                .inner_line_single_block,
                .home_fader_grid,
                .theme_button input,
                .theme_button a,
                .sidebar_bubble,
                .big_icon,
                .single_special_line,
                #right_rect,
                #left_rect,
                .special_line,
                .member_function,
                .prk_blockquote.colored_background,
                #tp_side_plus,
                .blog_squared_icon,
                .prk_blockquote.colored_background,
                .tiny_line,
                .back_activated_color,
                .wpb_content_element .wpb_accordion_wrapper .wpb_accordion_header,
                .filter_shortcodes .scode_categories li.active a,
                .active_bar {
                    background-color:$active_color;
                }
                .prk_accordion .ui-accordion-content,
                .wpb_accordion_content,
                .wpb_tour .wpb_tour_tabs_wrapper .wpb_tab,
                .ui-tabs .ui-tabs-nav li,
                .wpb_content_element.wpb_tabs .wpb_tour_tabs_wrapper .wpb_tab,
                .prk_speech,
                .tooltipster-light.inverted,
                .small_squared,
                .inactive_bar,
                .cart-collaterals table,
                .shop_table,
                .woocommerce #payment,
                .woocommerce-error,
                .prk_price_header,
                .liner,
                .es-nav span,
                .btn-primary,
                #magic-line,
                .pirenko_highlighted,
                #nav-main.resp_mode,
                .timeline_tip_top_hide,
                .prk_timeline_tip,
                .tip_top_hide,
                .prk_inner_tip,
                .prk_blockquote,
                #author_area.prk_blockquote.colored_background,
                .colored_bg {
                    background-color:$background_color;
                }
                .pir_divider,
                .pir_strong_divider,
                .pir_divider_onbg {
                    background-color:rgba($splitted_menu_up_color[0], $splitted_menu_up_color[1], $splitted_menu_up_color[2],0.6);
                }
                .inner_line_sidebar_block
                {
                    background-color:rgba($splitted_active_color[0], $splitted_active_color[1], $splitted_active_color[2],0.5);
                }
                .sf-menu .sub-menu {
                    border-top:0px solid $background_color_header;
                }
                #menu_section.under_logo .sf-menu>li>a {
                    border-bottom:0px solid;
                }
                #prk_responsive_menu.at_top,
                .sf-menu li>a {
                    border-bottom:1px solid ".$options['menu_lines_color'].";
                }
                #portfolio_info {
                    border-left:1px solid $inactive_color;
                    border-left:1px solid rgba($splitted_inactive_color[0], $splitted_inactive_color[1], $splitted_inactive_color[2],0.25);
                }
                .wpb_tabs .ui-tabs .ui-tabs-panel {
                    border-top:4px solid $active_color;
                }
                .wpb_tour .wpb_tour_tabs_wrapper .wpb_tab {
                    border-left:1px solid $site_background_color;
                }
                .wpb_separator, 
                .vc_text_separator,
                .post_meta_single,
                .simple_line,
                .simple_line_onbg,
                .low_subheading,
                .timeline_entry_marker,
                .simple_line.special_size,
                .simple_line.header_divider {
                    border-bottom: 1px solid $lines_color;
                }
                .simple_line.blog_divider {
                    border-bottom: 6px solid $lines_color;
                }
                .tinys_wrapper,
                .simple_line.thick {
                    border-bottom: 4px solid $background_color;
                }
                #menu_section .tinys_wrapper {
                    border-bottom:4px solid ".$options['menu_lines_color'].";
                }
                .prk_titlify_father h2,
                .prk_titlify_father h3,
                .prk_titlify_father h4,
                .prk_titlify_father .prk_vc_title,
                .prk_titlify_father .widget-title {
                    border-bottom: 4px solid $active_color;
                }
                .commentlist li .comment-author img {
                    outline: 1px solid $lines_color;
                }
                .prk_prices_specs li,
                .underp,
                .prk_prices_specs {
                    border-bottom: 1px solid $lines_color;
                    border-bottom:1px solid rgba($splitted_lines_color[0], $splitted_lines_color[1], $splitted_lines_color[2],0.65);
                }
                .prk_prices_specs {
                    border-top: 1px solid $lines_color;
                    border-top:1px solid rgba($splitted_lines_color[0], $splitted_lines_color[1], $splitted_lines_color[2],0.65);
                }
                .triangle-topleft {
                    border-top: 50px solid $active_color;
                }
                .prk_price_header,
                .post_meta_single,
                #respond .low_subheading,
                .timeline_entry_marker,
                #prk_gallery_footer {
                    border-top:1px solid $lines_color;
                }
                .wpb_row .wpb_column:last-child .wpb_wrapper .prk_price_table .prk_prices_specs,
                .wpb_row .wpb_column:last-child .wpb_wrapper .prk_price_table .prk_price_header,
                #prk_gallery_counter {
                    border-right:1px solid $lines_color;
                }
                .timeline_line_inner,
                .comments_liner,
                .prk_prices_specs,
                .prk_price_header,
                #prk_gallery_project_nav,
                #prk_gallery_share {
                    border-left:1px solid $lines_color;
                }
                .cart-collaterals table,
                table,
                td,
                .woocommerce .quantity input.qty, 
                .woocommerce #content .quantity input.qty, 
                .woocommerce-page .quantity input.qty, 
                .woocommerce-page #content .quantity input.qty,
                .pirenko_highlighted,
                .pk_contact_highlighted,
                .shop_table,
                .woocommerce #payment,
                .woocommerce-error,
                .prk_bordered {
                    border:1px solid $lines_color;
                }
                .simple_line_colored
                {
                    border-bottom: 1px solid rgba($splitted_active_color[0], $splitted_active_color[1], $splitted_active_color[2],0.8);
                }
                .portfolio_entry_li_db
                {
                    background-color:rgba($splitted_background_color[0], $splitted_background_color[1], $splitted_background_color[2],0.05); 
                }
                .read_more_text
                {
                    background-color:$inactive_color;
                }
                input, 
                textarea, 
                select, 
                .uneditable-input {         
                    border: 1px solid $inactive_color;
                }
                .page-header
                {
                    border-bottom: 1px solid $inactive_color;
                    border-bottom:1px solid rgba($splitted_inactive_color[0], $splitted_inactive_color[1], $splitted_inactive_color[2], 0.20);
                }
                .wpb_tour .ui-state-active, 
                .wpb_tour .ui-widget-content .ui-state-active, 
                .wpb_tour .ui-widget-header .ui-state-active,  
                .wpb_tour .ui-tabs .ui-tabs-nav li.ui-state-active,
                .wpb_tabs .ui-tabs-nav .ui-state-active, 
                .wpb_tabs .ui-tabs-nav .ui-widget-content .ui-state-active, 
                .wpb_tabs .ui-tabs-nav .ui-widget-header .ui-state-active,  
                .wpb_tabs .ui-tabs-nav .ui-tabs .ui-tabs-nav li.ui-state-active {
                    background-color:$active_color;
                }
                ";
                if ($submenu_color!="") {
                    $css .= "#menu_section .sf-menu li a {
                     background-color:$submenu_color;
                 }";
                }
                if ($options['coll_menu_border_color']!="") {
                    $css .= "#prk_responsive_menu {
                        border-right:1px solid ".$options['coll_menu_border_color'].";
                    }";
                }
                else
                {
                    $css .= "#top_bar_wrapper>.fifty_button:first-child {
                        border-left:1px solid $menu_active_color;
                        border-left: 1px solid rgba($splitted_site_background_color[0], $splitted_site_background_color[1], $splitted_site_background_color[2],0.5);
                    }";
                }
                if ($options['menu_border_color']!="") {
                    $css .= "#menu_section {
                        border-right:1px solid ".$options['menu_border_color'].";
                    }";
                }
                global $retina_device;
                //SHADOWS
                if (($custom_shadow)>0) {
                    $css .= 
                    ".boxed_shadow {
                        -webkit-box-shadow:0px 0px 1px rgba($splitted_shadow_color[0], $splitted_shadow_color[1], $splitted_shadow_color[2],".$custom_shadow.");
                        box-shadow:0px 0px 1px rgba($splitted_shadow_color[0], $splitted_shadow_color[1], $splitted_shadow_color[2],".$custom_shadow.");
                    }
                    .woocommerce .boxed_shadow {
                        -webkit-box-shadow:0px 0px 1px rgba($splitted_shadow_color[0], $splitted_shadow_color[1], $splitted_shadow_color[2],".$custom_shadow.") !important;
                        box-shadow:0px 0px 1px rgba($splitted_shadow_color[0], $splitted_shadow_color[1], $splitted_shadow_color[2],".$custom_shadow.") !important;
                    }
                    ";
                }

                if ($options['use_custom_colors']=="no")
                {
                    $css .= 
                    ".prk_menu_square {
                        display:none;
                    }
                    ";
                }

                //EXTRA STYLES IF VC IS OFF
                if (PRK_COMPOSER=="false")
                {
                    $css .= ".prk_no_composer {margin-bottom:32px;}
                    ";
                }
                if ($options['css_text']!="")
                {
                    $css .= $options['css_text'];
                }
                //RESPONSIVE STYLES
                if ($options['responsive_width']<769){
                    $options['responsive_width']=769;
                }
                if ($options['responsive']=="true") {
                    $css .= "@media(min-width:768px) and (max-width:".$options['responsive_width']."px) {
                            #sidebar {
                                width:195px;
                            }
                            #full-screen-background-image {
                                padding-left:0px;
                            }
                            #prk_ajax_container {
                                margin-left: 90px;
                            }
                            #top_bar_wrapper {
                                margin-left:90px;
                                left:0px;
                            }
                            #prk_responsive_menu {
                                display: block;
                            }
                            #st-container.no-csstransforms3d #menu_section{
                                margin-left:-260px;
                            }
                            .sidebarized.columns {
                                padding-right:215px;
                            }
                            .halfsized.columns {
                                padding-right:285px;
                            }
                            #single-entry-content_half,
                            #full-entry-right {
                                width:265px;
                            }
                            #single_blog_content .single_blog_meta_div.right_floated,
                            #classic_blog_section .single_blog_meta_div.right_floated {
                                float:left;
                            }
                            #single_blog_content .single_blog_meta_div.right_floated .left_floated,
                            #classic_blog_section .single_blog_meta_div.right_floated .left_floated  {
                                float:right;
                            }
                            #classic_blog_section .single_blog_meta_div.right_floated [class*=' navicon-'], 
                            #classic_blog_section .single_blog_meta_div.right_floated [class^='navicon-'],
                            #single_blog_content .single_blog_meta_div.right_floated [class*=' navicon-'], 
                            #single_blog_content .single_blog_meta_div.right_floated [class^='navicon-'] {
                                margin-left:0px !important;
                                margin-right:6px !important;
                                float:left;
                            }
                            #samba_collapse_menu {
                                visibility:visible;
                            }
                        }";
                    $css .= "@media only screen and (max-width: 767px) {
                        .prk_price_table .prk_prices_specs,
                        .prk_price_table .prk_price_header {
                            border-right:1px solid $lines_color;
                        }
                    }";
                }
        //OUTPUT THE CUSTOM STYLES WE JUST BUILT                
        wp_add_inline_style( 'samba_other_styles', $css );
    }

    //ADD CUSTOM SCRIPTS FOR THE BACKEND
    function samba_admin_scripts() 
    {
        if (function_exists('wp_get_theme'))
            $prk_theme = wp_get_theme();
        else
        {
            $prk_theme->Version="1";
        }
        wp_enqueue_script('media-upload');
        wp_enqueue_script('thickbox');
        wp_register_script('my-upload', get_template_directory_uri() .'/js/admin.js', array('jquery','media-upload','thickbox'), $prk_theme->Version, true);
        wp_enqueue_script('my-upload');
        wp_register_script('c_picker', get_template_directory_uri() .'/inc/admin/colorpicker.js', array('jquery'), null, true);
        wp_enqueue_script('c_picker');
        wp_register_style( 'c_picker_css', get_template_directory_uri() . '/inc/admin/colorpicker.css' );
        wp_enqueue_style('c_picker_css');
        wp_register_style( 'prk_admin_css', get_template_directory_uri() . '/css/admin.css',false,$prk_theme->Version );
        wp_enqueue_style('prk_admin_css');
        wp_enqueue_style('thickbox');
    }

    //FUNCTION TO SPLIT COLOR INTO RGB VALUES
    function html2rgb($color)
    {
        if ($color[0] == '#')
            $color = substr($color, 1); 
        if (strlen($color) == 6)
            list($r, $g, $b) = array($color[0].$color[1],$color[2].$color[3],$color[4].$color[5]);
                elseif (strlen($color) == 3)
                    list($r, $g, $b) = array($color[0].$color[0], $color[1].$color[1], $color[2].$color[2]);
                else
                    return false;
        $r = hexdec($r); $g = hexdec($g); $b = hexdec($b);
        return array($r, $g, $b);
    }
    
    //FUNCTION TO GENERATE A BRIGHTER COLOR
    function alter_brightness($hex, $steps) {
        // Steps should be between -255 and 255. Negative = darker, positive = lighter
        $steps = max(-255, min(255, $steps));
    
        // Format the hex color string
        $hex = str_replace('#', '', $hex);
        if (strlen($hex) == 3) {
            $hex = str_repeat(substr($hex,0,1), 2).str_repeat(substr($hex,1,1), 2).str_repeat(substr($hex,2,1), 2);
        }
    
        // Get decimal values
        $r = hexdec(substr($hex,0,2));
        $g = hexdec(substr($hex,2,2));
        $b = hexdec(substr($hex,4,2));
    
        // Adjust number of steps and keep it inside 0 to 255
        $r = max(0,min(255,$r + $steps));
        $g = max(0,min(255,$g + $steps));  
        $b = max(0,min(255,$b + $steps));
    
        $r_hex = str_pad(dechex($r), 2, '0', STR_PAD_LEFT);
        $g_hex = str_pad(dechex($g), 2, '0', STR_PAD_LEFT);
        $b_hex = str_pad(dechex($b), 2, '0', STR_PAD_LEFT);
    
        return '#'.$r_hex.$g_hex.$b_hex;
    }

    function samba_setup() {
        //ADD THE DEFAULT LOCATIONS IF NECESSARY
        if ( is_nav_menu( 'Top Right Navigation'  ) )
        {
            //DO NOTHING. THE MENU ALREADY EXISTS
        }
        else
        {
          register_nav_menus(array(
            'top_right_navigation' => __('Top Right Navigation', 'samba_lang')));
        }
        //THIS MENU IS MANDATORY!
        if ( is_nav_menu( PRK_THEME_NAME.' Main Menu'  ) )
        {
            //DO NOTHING. THE MENU ALREADY EXISTS   
        }
        else
        {
            /*ADD THE DEFAULT FOOTER MENU
            $name = PRK_THEME_NAME.' Main Menu';
            $menu_id = wp_create_nav_menu($name);
            $menu = get_term_by( 'name', $name, 'nav_menu' );
            //ASSIGN THE MENU TO THE DEFAULT LOCATION
            $locations = get_theme_mod('nav_menu_locations');
            $locations['top_right_navigation'] = $menu->term_id;
            set_theme_mod( 'nav_menu_locations', $locations );
            //ADD THE HOMEPAGE BUTTON
            $menu = 
                array( 
                    'menu-item-type' => 'custom', 
                    'menu-item-url' => site_url(),
                    'menu-item-title' => 'Home',
                    'menu-item-attr-title' => 'description',
                    'menu-item-status' => 'publish'
                );
            wp_update_nav_menu_item( $menu_id, 0, $menu );*/
        }
        
        // Add post thumbnails (http://codex.wordpress.org/Post_Thumbnails)
        add_theme_support('post-thumbnails');
      
        // Tell the TinyMCE editor to use a custom stylesheet
        add_editor_style('css/editor-style.css');
    }

    function prk_samba_header() {
        global $prk_samba_frontend_options;
        global $post;
        global $retina_device;
        global $prk_translations;
        $prk_translations=$prk_samba_frontend_options;
        //TRANSLATE ACCORDING TO THE SELECTED METHOD
        if ($prk_samba_frontend_options['theme_translation']=="yes")
        {
            // Make theme available for translation
            load_theme_textdomain('samba_lang', get_template_directory() . '/lang');
            $prk_translations['404_title_text']=__("Page Not Found", 'samba_lang');
            $prk_translations['404_body_text']=__("We do not know how you ended up here, but please could you try again by selecting an option on the menu?", 'samba_lang');
            $prk_translations['search_tip_text']=__("Type and hit ENTER", 'samba_lang');
            $prk_translations['submit_search_res_title']=__("Search Results For", 'samba_lang');
            $prk_translations['submit_search_no_results']=__("No Results Found", 'samba_lang');
            $prk_translations['load_more']=__("LOAD MORE POSTS", 'samba_lang');
            $prk_translations['no_more_text']=__("NO MORE POSTS TO SHOW", 'samba_lang');
            $prk_translations['required_text']=__(" (required)", 'samba_lang');
            $prk_translations['like_text']=__("I like this!", 'samba_lang');
            $prk_translations['already_liked_text']=__("You already liked this.", 'samba_lang');
            $prk_translations['share_text']=__("Share on", 'samba_lang');
            $prk_translations['in_touch_text']=__("Get In Touch", 'samba_lang');
            $prk_translations['to_portfolio']=__("To Portfolio", 'samba_lang');
            $prk_translations['launch_text']=__("Project URL", 'samba_lang');
            $prk_translations['skills_text']=__("Skills", 'samba_lang');
            $prk_translations['tags_text']=__("Tags", 'samba_lang');
            $prk_translations['client_text']=__("Client", 'samba_lang');
            $prk_translations['date_text']=__("Date", 'samba_lang');
            $prk_translations['related_text']=__("Related Projects", 'samba_lang');
            $prk_translations['all_text']=__("All", 'samba_lang');
            $prk_translations['sticky_text']=__("Sticky Post", 'samba_lang');
            $prk_translations['to_blog']=__("To Blog", 'samba_lang');
            $prk_translations['read_more']=__("READ MORE", 'samba_lang');
            $prk_translations['posted_by_text']=__("By", 'samba_lang');
            $prk_translations['about_author_text']=__("About", 'samba_lang');
            $prk_translations['comments_label']=__("Comments", 'samba_lang');
            $prk_translations['comments_no_response']=__("No Comments Yet", 'samba_lang');
            $prk_translations['comments_one_response']=__("One Comment", 'samba_lang');
            $prk_translations['comments_oneplus_response']=__("Comments", 'samba_lang');
            $prk_translations['reply_text']=__("Reply", 'samba_lang');
            $prk_translations['comments_leave_reply']=__("Leave a Reply", 'samba_lang');
            $prk_translations['comments_author_text']=__("Nome", 'samba_lang');
            $prk_translations['comments_email_text']=__("Email", 'samba_lang');
            $prk_translations['comments_url_text']=__("Website", 'samba_lang');
            $prk_translations['comments_comment_text']=__("Comment", 'samba_lang');
            $prk_translations['comments_submit']=__("Submit Comment", 'samba_lang');
            $prk_translations['empty_text_error']=__("Error! Please fill all the required fields.", 'samba_lang');
            $prk_translations['invalid_email_error']=__("Error! Invalid email.", 'samba_lang');
            $prk_translations['comment_ok_message']=__("Thank you for your feedback!", 'samba_lang');
            $prk_translations['contact_subject_text']=__("Subject", 'samba_lang');
            $prk_translations['contact_message_text']=__("Your Message", 'samba_lang');
            $prk_translations['contact_submit']=__("Send Message", 'samba_lang');
            $prk_translations['contact_wait_text']=__("Please Wait...", 'samba_lang');
            $prk_translations['contact_ok_text']=__("Thank you for contacting us. We will reply soon!", 'samba_lang');
        }
        $retina_device="prk_not_retina";
        if (isset($_COOKIE['samba_retina'])) {
            $retina_device=$_COOKIE['samba_retina'];
        }
        //OVERRIDE OPTIONS - ONLY FOR PREVIEW MODE
        if (INJECT_STYLE)
        {
            include(ABSPATH . 'wp-content/plugins/color-manager-samba/style_header.php');   
        }   
    }
    function prk_dims($img_url,$ret_divider) {
        $file_path = parse_url( $img_url );
        $file_path = $_SERVER['DOCUMENT_ROOT'] . $file_path['path'];
        
        if (!file_exists($file_path)) {
            // Double check for some kind of virtual path that fails with $_SERVER['DOCUMENT_ROOT']
            $imageParts = explode(site_url(), $img_url, 2);
            if (isset($imageParts[1])) {
                $file_path = ABSPATH  . $imageParts[1];
            }
            // if not found with the backup path...
            if (!file_exists($file_path)) {
                // simple fix for direct links to images on multi-site installs
                if (isset($blog_id) && $blog_id > 0) {
                    // uploaded images to media folders
                    $imageParts = explode('/files/', $img_url, 2);
                    if (isset($imageParts[1])) {
                        $img_url = get_site_url(1) .'/wp-content/blogs.dir/'. $blog_id .'/files/'. $imageParts[1];
                        $file_path = parse_url( $img_url );
                        $file_path = $_SERVER['DOCUMENT_ROOT'] . $file_path['path'];
                    }
                    // if not found in media folders check theme folders
                    if (!file_exists($file_path)) {
                        // files in the theme folder
                        $imageParts = explode('THEME_URL', $img_url, 2);
                        if (isset($imageParts[1])) {
                            $file_path = THEME_DIR . $imageParts[1];
                        }
                    }
                }
            }
        }
        list($width, $height) = getimagesize($file_path);
        //$width=$width/$ret_divider;
        //$height=$height/$ret_divider;
        return 'width="'.$width.'" height="'.$height.'"';
    }
    function prk_output_featured_image($prk_page_id) {
        if (has_post_thumbnail($prk_page_id))
        {
            $image = wp_get_attachment_image_src( get_post_thumbnail_id($prk_page_id), 'single-post-thumbnail' );
            return '<img id="full-screen-background-image" src="'. $image[0] . '" >';
        }
    }
    function prk_output_logo($retina_device) 
    {
        global $prk_samba_frontend_options;
        if ($retina_device=="prk_retina" && isset($prk_samba_frontend_options['logo_retina']) && $prk_samba_frontend_options['logo_retina']!="") 
        {
            $logo_dims=prk_dims($prk_samba_frontend_options['logo_retina'],2);
            $out_logo='<img src="'.$prk_samba_frontend_options['logo_retina'].'" alt="" '.$logo_dims.' class="prk_logo_image '.$retina_device.'" />';
        }
        else
        {
            $logo_dims=prk_dims($prk_samba_frontend_options['logo'],1);
            $out_logo='<img src="'.$prk_samba_frontend_options['logo'] .'" alt="" '.$logo_dims.' class="prk_logo_image '.$retina_device.'" />';
        }
        return $out_logo;
    }
    function prk_output_alt_logo($retina_device) 
    {
        global $prk_samba_frontend_options;
        if ($retina_device=="prk_retina" && isset($prk_samba_frontend_options['alt_logo_retina']) && $prk_samba_frontend_options['alt_logo_retina']!="") 
        {
            $alt_logo_dims=prk_dims($prk_samba_frontend_options['alt_logo_retina'],2);
            $out_logo='<img id="prk_alt_logo_image" alt="" src="'.$prk_samba_frontend_options['alt_logo_retina'].'" '.$alt_logo_dims.' class="'.$retina_device.'" />';
            return $out_logo;
        }
        else
        {
            if (isset($prk_samba_frontend_options['alt_logo']) && $prk_samba_frontend_options['alt_logo']!="") {
                $alt_logo_dims=prk_dims($prk_samba_frontend_options['alt_logo'],1);
                $out_logo='<img id="prk_alt_logo_image" alt="" src="'.$prk_samba_frontend_options['alt_logo'].'" '.$alt_logo_dims.' class="'.$retina_device.'" />';
                return $out_logo;
            }
            else
            {
                echo prk_output_logo($retina_device);
            }
        }
    }
    function prk_output_small_logo($retina_device) 
    {
        global $prk_samba_frontend_options;
        if ($retina_device=="prk_retina" && isset($prk_samba_frontend_options['logo_retina']) && $prk_samba_frontend_options['logo_retina']!="") 
        {
            $logo_dims=prk_dims($prk_samba_frontend_options['logo_retina'],2);
            if(isset($prk_samba_frontend_options['small_logo_retina']) && $prk_samba_frontend_options['small_logo_retina']!="") 
            {
                $logo_dims=prk_dims($prk_samba_frontend_options['small_logo_retina'],2);
                $out_logo='<img src="'.$prk_samba_frontend_options['small_logo_retina'].'" alt="" '.$logo_dims.' class="prk_small_logo_image '.$retina_device.'" />';
            }
            else 
            {
                if(isset($prk_samba_frontend_options['small_logo']) && $prk_samba_frontend_options['small_logo']!="") 
                {
                    $logo_dims=prk_dims($prk_samba_frontend_options['small_logo'],2);
                    $out_logo='<img src="'.$prk_samba_frontend_options['small_logo'].'" alt="" '.$logo_dims.' class="prk_small_logo_image '.$retina_device.'" />';
                }
                else 
                {
                    $out_logo='<img src="'.$prk_samba_frontend_options['logo'].'" alt="" '.$logo_dims.' class="prk_small_logo_image '.$retina_device.'" />';
                }
            }
        }
        else
        {
            $logo_dims=prk_dims($prk_samba_frontend_options['logo'],1);
            if(isset($prk_samba_frontend_options['small_logo']) && $prk_samba_frontend_options['small_logo']!="") 
            {
                $logo_dims=prk_dims($prk_samba_frontend_options['small_logo'],2);
                $out_logo='<img src="'.$prk_samba_frontend_options['small_logo'].'" alt="" '.$logo_dims.' class="prk_small_logo_image '.$retina_device.'" />';
            }
            else 
            {
                $out_logo='<img src="'.$prk_samba_frontend_options['logo'].'" alt="" '.$logo_dims.' class="prk_small_logo_image '.$retina_device.'" />';
            }
        }
        return $out_logo;
    }
    //BREADCRUMBS
    function prk_crumbs() 
    {
        global $post;
         if (is_page() || is_home() || is_category() || is_single() || is_tag() || is_archive() || is_search()) 
         {
            echo '<ul id="breadcrumbs" class="bd_headings_text_shadow rotated">';
            if (get_option('page_on_front'))
                echo '<li><a href="'.get_bloginfo('url').'">'.get_the_title(get_option('page_on_front')).'</a></li>';
            else
                echo '<li><a href="'.get_bloginfo('url').'">'.get_bloginfo('title').'</a></li>';
            if (isset($post->ID)) 
            {
                $post_ancestors = get_post_ancestors($post->ID);
                $curr_link=get_permalink($post->ID);
            }
            else
            {
                $curr_link="";
            }
            if (is_search())
            {
                echo '<li>'.__("Search", 'samba_lang').'</li>';
            }
            else 
            {
                 if (isset($post_ancestors)) 
                 {
                     $post_ancestors = array_reverse($post_ancestors);
                     foreach ($post_ancestors as $crumb)
                     echo '<li><span class="divider">|</span><a href="'.get_permalink($crumb).'">'.get_the_title($crumb).'</a></li>';
                 }
                 if (is_category()) {
                     $category = get_the_category();
                     echo '<li>'.$category[0]->cat_name.'</li>';
                 }
                 if  (is_single() && get_post_type()!="pirenko_portfolios") {
                     $category = get_the_category();
                     if (!empty($category))
                        echo '<li><span class="divider">|</span><a href="'.get_category_link($category[0]->cat_ID).'">'.$category[0]->cat_name.'</a></li>';
                 }
                 if  (is_single() && get_post_type()=="pirenko_portfolios") {
                     if (get_the_term_list(get_the_ID(),'pirenko_skills')!="")
                        echo get_the_term_list(get_the_ID(),'pirenko_skills',"<li><span class='divider'>|</span>","</li><li><span class='divider'>|</span>","</li>");
                 }
                 if (is_tag()) {
                    $tags= get_tags(); 
                     foreach ($tags as $tag){
                        echo "<li><span class='divider'>|</span>".$tag->name."</li>";
                    }
                 }
                 if (is_day()) 
                    { 
                        echo "<li><span class='divider'>|</span>".get_the_time('F jS, Y')."</li>";
                    } 
                    elseif (is_month()) 
                    { 
                        echo "<li><span class='divider'>|</span>".get_the_time('F, Y')."</li>";
                    } 
                    elseif (is_year()) 
                    { 
                        echo "<li><span class='divider'>|</span>".get_the_time('Y')."</li>";
                    }
                    if ($curr_link=="")
                    {
                        if (!is_category() && !is_tag() && !is_archive())
                            echo "<li><span class='divider'>|</span>".get_the_title()."</li>";
                    }
                    else
                    {
                        if (!is_category() && !is_tag() && !is_archive() && includeTrailingCharacter(get_home_url(),"/")!=includeTrailingCharacter($curr_link,"/"))
                            echo "<li><span class='divider'>|</span>".get_the_title()."</li>";
                    }
            }
             echo '</ul>';
        }
    }
    function includeTrailingCharacter($string, $character)
    {
        if (strlen($string) > 0) {
            if (substr($string, -1) !== $character) {
                return $string . $character;
            } else {
                return $string;
            }
        } else {
            return $character;
        }
    }


    //RECEIVES SOCIAL NETWORK LABEL AND RETURN HEXA COLOR
    function prk_social_color($network_label) {
        switch ($network_label) {
            case 'delicious':
                return "#3274d1";
                break;
            case 'deviantart':
                return "#54675a";
                break;
            case 'dribbble-2':
                return "#ca4578";
                break;
            case 'facebook-2':
                return "#1f69b3";
                break;
            case 'flickr-2':
                return "#fd0083";
                break;
            case 'google-plus-2':
                return "#222222";
                break;
            case 'instagram':
                return "#547FA2";
                break;
            case 'linkedin':
                return "#1a7696";
                break;
            case 'pinterest':
                return "#df2126";
                break;
            case 'skype':
                return "#28a9ED";
                break;
            case 'soundcloud':
                return "#f8500f";
                break;
            case 'twitter-2':
                return "#43b3e5";
                break;
            case 'vimeo2':
                return "#4ab2d9";
                break;
            case 'yahoo':
                return "#855c9c";
                break;
            case 'youtube-2':
                return "#fb2d39";
                break;
            case 'feed-2':
                return "#ed8333";
                break;
            default:
                return "#000000";
        }
    }

    function prk_get_parent_blog() 
    {
        global $post;
        $blog_default="";
        $blog_link="";
        $arra=get_the_category( get_the_ID());
        $cats_arr = array("");
        if($arra) {
            foreach($arra as $s_cat) {
                array_push($cats_arr,$s_cat->slug);
            }
        }
        $pages_blog = get_pages(array(
            'meta_key' => '_wp_page_template',
            'meta_value' => 'template_blog.php'
        )); 
        foreach($pages_blog as $page_blog)
        {
            $blog_default=$page_blog->post_id;
            //CHECK IF THIS BLOG PAGE CONTAINS THE CATEGORY CURRENTLY BEING USED
            $data = get_post_meta($page_blog->post_id, '_custom_meta_blog_template', TRUE);
            $in_flag=false;
            foreach ($data as $childs)
            {
                //ADD THE CATEGORIES TO THE FILTER
                if ($in_flag==true)
                {
                    if (in_array($childs, $cats_arr)) {
                        $blog_link=$page_blog->post_id; 
                    }
                }
                if ($childs=='weirdostf')
                {
                  $in_flag=true;
                }
            }
        }
        $pages_blog = get_pages(array(
            'meta_key' => '_wp_page_template',
            'meta_value' => 'template_blog_masonry.php'
        )); 
        foreach($pages_blog as $page_blog)
        {
            $blog_default=$page_blog->post_id;
            //CHECK IF THIS BLOG PAGE CONTAINS THE CATEGORY CURRENTLY BEING USED
            $data = get_post_meta($page_blog->post_id, '_custom_meta_blog_template', TRUE);
            $in_flag=false;
            foreach ($data as $childs)
            {
                //ADD THE CATEGORIES TO THE FILTER
                if ($in_flag==true)
                {
                    if (in_array($childs, $cats_arr)) {
                        $blog_link=$page_blog->post_id; 
                    }
                }
                if ($childs=='weirdostf')
                {
                  $in_flag=true;
                }
            }
        }
        if ($blog_link!="") {
            return $blog_link;
        }
        else
        {
            return $blog_default;
        }
        wp_reset_query();
    }
    function prk_get_parent_portfolio() 
    {
        global $post;
        $blog_default="";
        $blog_link="";
        $blog_link_timeline="";
        $arra=get_the_terms( get_the_ID(),'pirenko_skills' );
        $cats_arr = array("");
        if($arra) {
            foreach($arra as $s_cat) {
                array_push($cats_arr,$s_cat->slug);
            }
        }
        $pages_blog = get_pages(array(
            'meta_key' => '_wp_page_template',
            'meta_value' => 'template_portfolio_var-grid.php'
        )); 
        foreach($pages_blog as $page_blog)
        {
            $blog_default=$page_blog->ID;
            //CHECK IF THIS PORTFOLIO PAGE CONTAINS THE CATEGORY CURRENTLY BEING USED
            $data = get_post_meta($page_blog->ID, '_custom_meta_portfolio_template', TRUE);
            $in_flag=false;
            foreach ($data as $childs)
            {
                //ADD THE CATEGORIES TO THE FILTER
                if ($in_flag==true)
                {
                    if (in_array($childs, $cats_arr)) {
                        $blog_link=$page_blog->ID; 
                    }
                }
                if ($childs=='weirdostf')
                {
                  $in_flag=true;
                }
            }
        }
        $pages_blog = get_pages(array(
            'meta_key' => '_wp_page_template',
            'meta_value' => 'template_portfolio_titled.php'
        )); 
        foreach($pages_blog as $page_blog)
        {
            $blog_default=$page_blog->ID;
            //CHECK IF THIS PORTFOLIO PAGE CONTAINS THE CATEGORY CURRENTLY BEING USED
            $data = get_post_meta($page_blog->ID, '_custom_meta_portfolio_template', TRUE);
            $in_flag=false;
            foreach ($data as $childs)
            {
                //ADD THE CATEGORIES TO THE FILTER
                if ($in_flag==true)
                {
                    if (in_array($childs, $cats_arr)) {
                        $blog_link=$page_blog->ID; 
                    }
                }
                if ($childs=='weirdostf')
                {
                  $in_flag=true;
                }
            }
        }
        $pages_blog = get_pages(array(
            'meta_key' => '_wp_page_template',
            'meta_value' => 'template_portfolio_masonry.php'
        )); 
        foreach($pages_blog as $page_blog)
        {
            $blog_default=$page_blog->ID;
            //CHECK IF THIS PORTFOLIO PAGE CONTAINS THE CATEGORY CURRENTLY BEING USED
            $data = get_post_meta($page_blog->ID, '_custom_meta_portfolio_template', TRUE);
            $in_flag=false;
            foreach ($data as $childs)
            {
                //ADD THE CATEGORIES TO THE FILTER
                if ($in_flag==true)
                {
                    if (in_array($childs, $cats_arr)) {
                        $blog_link=$page_blog->ID; 
                    }
                }
                if ($childs=='weirdostf')
                {
                    $in_flag=true;
                }
            }
        }
        if ($blog_link!="") {
            return $blog_link;
        }
        else
        {
            return $blog_default;
        }
        wp_reset_query();
    }
    function prk_output_title($data)
    {
        global $post;
        global $prk_samba_frontend_options;
        global $retina_device;
        //INFO BAR DEFAULT IMAGE?
        if (isset($prk_samba_frontend_options['backgroundinfo_image']) && $prk_samba_frontend_options['backgroundinfo_image']!="") {
            $image[0]=$prk_samba_frontend_options['backgroundinfo_image'];
        }
        else
        {
            $image[0]="no";
        }
        if (isset($post->ID) && has_post_thumbnail($post->ID))
        {
            $image=wp_get_attachment_image_src( get_post_thumbnail_id($post->ID),'single-post-thumbnail');
        }
        $show_line=true;
        if (isset($data['alchemy_hide_line']) && $data['alchemy_hide_line']=="yes") {
            $show_line=false;
        }
        $align_styled="";
        if (isset($data['alchemy_header_align']) && $data['alchemy_header_align']=="head_center")
        {
            $align_styled="head_center ";
        }
        if (count($data)>1 && isset($data['alchemy_bk_color']) && $data['alchemy_bk_color']!="") 
        {
            if (isset($data['alchemy_text_color']) && $data['alchemy_text_color']!="")                 
            {
                $splitted_shadow=html2rgb($data['alchemy_text_color']);
                $extra_styles='class="'.$align_styled.'" data-bkc="'.$data['alchemy_bk_color'].'" data-color="'.$data['alchemy_text_color'].'" data-c1="'.$splitted_shadow[0].'" data-c2="'.$splitted_shadow[1].'" data-c3="'.$splitted_shadow[2].'"';
            }
            else
            {
                $extra_styles='class="'.$align_styled.' bd_headings_text_shadow zero_color" data-bkc="'.$data['alchemy_bk_color'].'"';
            }
        }
        else
        {
            if (count($data)>1 && isset($data['alchemy_text_color']) && $data['alchemy_text_color']!="") 
            {
                $splitted_shadow=html2rgb($data['alchemy_text_color']);
                $extra_styles='class="'.$align_styled.'" data-color="'.$data['alchemy_text_color'].'" data-c1="'.$splitted_shadow[0].'" data-c2="'.$splitted_shadow[1].'" data-c3="'.$splitted_shadow[2].'"';
            }
            else
            {
                $extra_styles='class="'.$align_styled.'bd_headings_text_shadow zero_color"';
            }
        }
        if (is_page()) {
            ?>
                <div id="headings_wrap" <?php echo $extra_styles; ?>>
                    <div class="prk_inner_block centered twelve columns">
                        <div class="single_page_title twelve columns">
                            <?php 
                                if ($show_line==true)
                                {
                                    echo '<div class="prk_titlify_father">';
                                }
                            ?>
                            <h1 class="header_font">
                                <?php the_title(); ?>
                            </h1>
                            <?php 
                                if ($show_line==true)
                                {
                                    echo '</div>';
                                }
                                if (isset($data['alchemy_below_headings']) && $data['alchemy_below_headings']!="")
                                {
                                  ?>
                                  <div id="single_page_teaser">
                                  <?php
                                    echo $data['alchemy_below_headings'];
                                  ?>
                                  </div>
                                  <?php
                                }
                            ?>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            <?php
        }
        if (get_post_type()=="pirenko_portfolios") {
            ?>
                    <div id="headings_wrap" <?php echo $extra_styles; ?>>
                        <div class="prk_inner_block extra_pad centered twelve columns">
                            <div class="row">
                                <div class="single_page_title nine columns">
                                    <h1 class="header_font">
                                        <?php echo get_the_title(); ?>
                                    </h1>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
            <?php
        }
        if (is_single() && get_post_type()!="pirenko_portfolios") {
            ?>
                    <div id="headings_wrap" <?php echo $extra_styles; ?>>
                        <div class="prk_inner_block extra_pad centered twelve columns">
                                <div class="single_page_title twelve columns">
                                    <h1 class="header_font">
                                        <?php echo get_the_title($data); ?>
                                    </h1>
                                    <?php
                                        $data_blog = get_post_meta( $data, '_custom_meta_blog_template', true );
                                        if (isset($data_blog['alchemy_below_headings']) && $data_blog['alchemy_below_headings']!="")
                                        {
                                          ?>
                                          <div id="single_page_teaser">
                                          <?php
                                          echo $data_blog['alchemy_below_headings'];
                                          ?>
                                          </div>
                                          <?php
                                        }
                                    ?>
                                </div>
                            <div class="clearfix"></div>
                    </div>
                </div>
            <?php
        }
        if (is_archive() && get_post_type()!="pirenko_portfolios") {
            if (is_category()) 
            { 
                $prk_pagettl=single_cat_title('',FALSE);
            } 
            elseif( is_tag() ) 
            { 
                $prk_pagettl=single_tag_title('',FALSE);
            } 
            elseif (is_day()) 
            { 
                $prk_pagettl=get_the_time('F jS, Y');
            } 
            elseif (is_month()) 
            { 
                $prk_pagettl=get_the_time('F, Y');
            } 
            elseif (is_year()) 
            { 
                $prk_pagettl=get_the_time('Y');
            } 
            elseif (is_author()) 
            { 
                $prk_pagettl="Author Archive";
            }
            ?>
            <div id="headings_wrap" <?php echo $extra_styles; ?>>
                <div class="prk_inner_block centered twelve columns">
                    <div class="single_page_title twelve columns">
                        <?php 
                            if ($show_line==true)
                            {
                                echo '<div class="prk_titlify_father">';
                            }
                        ?>
                        <h1 class="header_font">
                            <?php echo $prk_pagettl; ?>
                        </h1>
                        <?php 
                            if ($show_line==true)
                            {
                                echo '</div>';
                            }
                        ?>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <?php
        }
    }
    function jquery_sender() 
    {
        global $retina_device;
        $jquery_options=get_option('samba_theme_options');
        //SEND VALUES TO JQUERY
        ?>
        <script type="text/javascript">
            var make_session = false;
            var retina_device = '<?php echo $retina_device ?>';
            jQuery(function() {
                if( window.devicePixelRatio ) {
                    if(window.devicePixelRatio > 1 && retina_device!=="prk_retina"){
                        jQuery.cookie("samba_retina","prk_retina",{ path: '/' });
                    }
                }
            });
            <?php echo $jquery_options['js_text']; ?>
        </script>
        <?php
    }
    //FUNCTION TO CHECK IF PATH CONTAINS YOUTUBE, VIMEO...
    function prk_external_content($stringa) {
        // check if string ends with image extension
        if (preg_match('/(\.jpg|\.png|\.bmp)$/', $stringa)) {
            return "other";
        // check if there is youtube.com in string
        } elseif (strpos($stringa, "youtube.com") !== false) {
            return "youtube";
        } elseif (strpos($stringa, "youtu.be") !== false) {
            return "youtube";
        // check if there is vimeo.com in string
        } elseif (strpos($stringa, "vimeo.com") !== false) {
            return "vimeo";
        } elseif (strpos($stringa, "soundcloud.com") !== false) {
            return "soundcloud";
        } else {
            return "other";
        }
    }
    function get_youtube_url($text) {
        $text = preg_replace('~
            # Match non-linked youtube URL in the wild. (Rev:20130823)
            https?://         # Required scheme. Either http or https.
            (?:[0-9A-Z-]+\.)? # Optional subdomain.
            (?:               # Group host alternatives.
              youtu\.be/      # Either youtu.be,
            | youtube\.com    # or youtube.com followed by
              \S*             # Allow anything up to VIDEO_ID,
              [^\w\-\s]       # but char before ID is non-ID char.
            )                 # End host alternatives.
            ([\w\-]{11})      # $1: VIDEO_ID is exactly 11 chars.
            (?=[^\w\-]|$)     # Assert next char is non-ID or EOS.
            (?!               # Assert URL is not pre-linked.
              [?=&+%\w.-]*    # Allow URL (query) remainder.
              (?:             # Group pre-linked alternatives.
                [\'"][^<>]*>  # Either inside a start tag,
              | </a>          # or inside <a> element text contents.
              )               # End recognized pre-linked alts.
            )                 # End negative lookahead assertion.
            [?=&+%\w.-]*        # Consume any URL (query) remainder.
            ~ix', 
            '$1',
            $text);
        return $text;
    }
    function get_iframe_src($raw_content) {
        if ($raw_content!="") {
            $doc = new DOMDocument();
            libxml_use_internal_errors(true);
            $doc->loadHTML($raw_content);
            libxml_use_internal_errors(false);
            $src = $doc->getElementsByTagName('iframe')->item(0)->getAttribute('src');
            if (prk_external_content($raw_content)=="youtube")
            {
                return "http://www.youtube.com/watch?v=".get_youtube_url($src);
            }
            if (prk_external_content($raw_content)=="vimeo")
            {
                return $src;
            }
            if (prk_external_content($raw_content)=="soundcloud")
            {
                return $src;
            }
        }
        else
        {
            return "No Content Is Set";
        }
    }
        
    //FUNCTION TO GET IMAGES PATH ON MULTISITE WORDPRESS INSTALLATIONS
    function get_image_path($src) 
    {
        global $blog_id;
        if(isset($blog_id) && $blog_id > 0) 
        {
            $imageParts = explode('/files/' , $src);//implode(",",$src)
            if(isset($imageParts[1])) 
            {
                $src = '/blogs.dir/' . $blog_id . '/files/' . $imageParts[1];
            }
        }
        return $src;
    }
    
    //VARIABLE SIZE EXCERPT FUNCTION
    function the_excerpt_dynamic($length) 
    {
        global $post;
        $text = $post->post_excerpt;
        if ( '' == $text )
        {
            $text = $post->post_content;
            if (strpos($text,'<!--more-->') !== false) {
                $text = substr($text,0,strpos($text,'<!--more-->'));
            }
            else
            {
                $text='';
            }
        }
        if ( '' == $text ) 
        {
            $text = get_the_content('');
            $text = apply_filters('the_content', $text);
            $text = str_replace(']]>', ']]>', $text);
        }
        if (strpos($text,'<!--more-->') !== false) {
            $text = substr($text,0,strpos($text,'<!--more-->'));
        }
        $text = strip_shortcodes( $text ); // optional, recommended
        $text = strip_tags($text); //THIS WILL REMOVE EVENTUAL HTML TAGS
        $text = preg_replace( "/\s+/", " ", $text );
        $output="";
        $words = explode( " ", $text );
        $nwords = count( $words );
        for ( $i = 0; ( $i < $length ) && ( $i < $nwords ); $i++ ) {
            $output .= $words[$i];
            if ( $i < $length - 1) {
                $output .= " ";
            } else {
                $output .= ' [...]';
            }
        }
        return apply_filters('the_excerpt',$output);
    }
    //CHECK IF EXCERPT IS LARGER THAN POST TEXT (USEFULL TO SEE IF WE NEED A READ MORE BUTTON)
    function is_big_excerpt($length) 
    {
        global $post;
        $text = $post->post_content;
        if ( '' == $text ) 
        {
            $text = get_the_content('');
            $text = apply_filters('the_content', $text);
            $text = str_replace(']]>', ']]>', $text);
        }
        if (strpos($text,'<!--more-->') !== false) {
            return true;
        }
        $text = $post->excerpt;
        if ( '' == $text ) 
        {
            $text = get_the_content('');
            $text = apply_filters('the_content', $text);
            $text = str_replace(']]>', ']]>', $text);
        }
        $text = strip_shortcodes( $text ); // optional, recommended
        $text = strip_tags($text);
        $text = preg_replace( "/\s+/", " ", $text );
        $words = explode( " ", $text );
        $nwords = count( $words );
        if ($nwords>$length)
            return true;
        else
            return false;
    }
    //POST LIKE FEATURE
    $timebeforerevote = 60;

    add_action('wp_ajax_nopriv_post-like', 'post_like');
    add_action('wp_ajax_post-like', 'post_like');   
    
    function post_like()
    {
        $nonce = $_POST['nonce'];
     
        if ( ! wp_verify_nonce( $nonce, 'ajax-nonce' ) )
            die ( 'Busted!');
            
        if(isset($_POST['post_like']))
        {
            $ip = $_SERVER['REMOTE_ADDR'];
            $post_id = $_POST['post_id'];
            
            $meta_IP = get_post_meta($post_id, "voted_IP");
            if (empty($meta_IP))
                    $meta_IP[0]="";
            $voted_IP = $meta_IP[0];
            if(!is_array($voted_IP))
                $voted_IP = array();
            
            $meta_count = get_post_meta($post_id, "votes_count", true);
    
            if(!already_voted($post_id))
            {
                $voted_IP[$ip] = time();
    
                update_post_meta($post_id, "voted_IP", $voted_IP);
                update_post_meta($post_id, "votes_count", ++$meta_count);
                
                echo $meta_count;
            }
            else
                echo "already";
        }
        exit;
    }
    
    function already_voted($post_id)
    {
        global $timebeforerevote;
    
        $meta_IP = get_post_meta($post_id, "voted_IP");
        if (empty($meta_IP))
            $meta_IP[0]="";
        $voted_IP = $meta_IP[0];
        if(!is_array($voted_IP))
            $voted_IP = array();
        $ip = $_SERVER['REMOTE_ADDR'];
        
        if(in_array($ip, array_keys($voted_IP)))
        {
            $time = $voted_IP[$ip];
            $now = time();
            
            if(round(($now - $time) / 60) > $timebeforerevote)
                return false;
                
            return true;
        }
        
        return false;
    }
    
    function get_folio_like($post_id,$show_number)
    {
        global $prk_translations;
        global $prk_samba_frontend_options; 
        $prk_samba_frontend_options=get_option('samba_theme_options');
        $output="";
        if ($prk_samba_frontend_options['show_heart_folio']=="yes")
        {
            $themename = "samba";
            $vote_count = get_post_meta($post_id, "votes_count", true);
            if ($vote_count=="")
                $vote_count=0;
            $output.='<div class="post-like left_floated">';
            $tip_txt="I like this!";
            $extra_class="";
            $tip_txt=$prk_translations['like_text'];
            if(already_voted($post_id))
            {
                $tip_txt=$prk_translations['already_liked_text'];
                $extra_class=" alreadyvoted";
            }
            if ($show_number==false) {
                $extra_class.=" hide_number";
            }
            $output .= '<a href="#" title="'.$tip_txt.'" data-no_more="'.$prk_translations['already_liked_text'].'" class="site_background_colored pir_like'.$extra_class.'" data-color="#ff3030" data-post_id="'.$post_id.'">';
            $output .= '<div class="navicon-heart-2 left_floated"></div>';
            $output .= '<div class="like_count left_floated">'.$vote_count.'</div>';
            $output .= '<div class="share_colored_bg"></div></a>';
            $output .= '<div class="clearfix"></div></div>';
        }
        return $output;
    }
    function get_blog_like($post_id,$show_number)
    {
        global $prk_translations;
        global $prk_samba_frontend_options; 
        $prk_samba_frontend_options=get_option('samba_theme_options');
        $output="";
        if ($prk_samba_frontend_options['show_heart_folio']=="yes")
        {
            $themename = "samba";
            $vote_count = get_post_meta($post_id, "votes_count", true);
            if ($vote_count=="")
                $vote_count=0;
            $output.='<div class="post-like left_floated">';
            $tip_txt="I like this!";
            $extra_class="";
            $tip_txt=$prk_translations['like_text'];
            if(already_voted($post_id))
            {
                $tip_txt=$prk_translations['already_liked_text'];
                $extra_class=" alreadyvoted";
            }
            if ($show_number==false) {
                $extra_class.=" hide_number";
            }
            $output .= '<a href="#" title="'.$tip_txt.'" data-no_more="'.$prk_translations['already_liked_text'].'" class="site_background_colored pir_like'.$extra_class.'" data-color="#ff3030" data-post_id="'.$post_id.'">';
            $output .= '<div class="navicon-heart-2 left_floated"></div>';
            $output .= '<div class="like_count left_floated">'.$vote_count.'</div>';
            $output .= '<div class="share_colored_bg"></div></a>';
            $output .= '<div class="clearfix"></div></div>';
        }
        return $output;
    }
    function prk_mail_before_submit(){
        if (isset($_POST['action']) && $_POST['action']=="mail_before_submit") {
            check_ajax_referer('ajax-nonce');
            $params = array();
            parse_str($_POST['email_wrap'], $params);
            $name = $params['c_name'];
            $mail = $params['c_email'];
            $admin_mail = $params['rec_email'];
            $msg = $params['c_message'];
            $subject = $params['full_subject'];

            $headers='MIME-Version: 1.0' . "\r\n";
            $headers.='Content-type: text/html; charset=utf-8' . "\r\n";
            $headers.="From: ". $name . "<". $mail .">" . "\r\n";
            $headers.='Reply-To: ' . $mail . "\r\n";
            $headers.='CC: ' . $mail ."\r\n";
            $headers.='X-Mailer: PHP/' . phpversion();

            $message="You've received a new message. <br><br>";
            $message.="Name: ".$name."<br>";
            $message.="Mail: ".$mail."<br>";
            $message.="Message: ".$msg."<br>";
            
            $mail_result = wp_mail($admin_mail,$subject,$message,$headers);
            if($mail_result) 
            {
                echo "sent";
            }
            else
            {
                echo "Email failure. Please try again.";
            }
        }
    }

    //FIX FOR COMPATIBILITY MODE ON IE
    /*
    Plugin Name: Force IE Edge
    Description: Add an X-UA-Compatible header to WordPress
    Author: Christopher Davis
    Author URI: http://christopherdavis.me
    License: GPL2
        
        Copyright 2012 Christopher Davis
    
        This program is free software; you can redistribute it and/or modify
        it under the terms of the GNU General Public License, version 2, as 
        published by the Free Software Foundation.
    
        This program is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU General Public License for more details.
    
        You should have received a copy of the GNU General Public License
        along with this program; if not, write to the Free Software
        Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
    */
    
    
    add_filter('wp_headers', 'cdfie_add_header');
    /*
     * Adds a header to WordPress
     *
     * @return array Where header => header value
     */
    function cdfie_add_header($headers)
    {
        $headers['X-UA-Compatible'] = 'IE=edge,chrome=1';
        return $headers;
    }
    
    //ADD PAGE SLUGS ON NAV ID'S - USEFULL FOR PORTFOLIO FILTERS
    function nav_id_filter( $id, $item ) {
    if (strpos($item->url,'/?') == true) 
    {
        //WE ARE USING THE DEFAULT PERMALINK SYSTEM
        //GRAB WHAT'S AFTER THE = SIGN
        $parts = substr(strrchr($item->url, "="), 1);
        return 'nav-'.$parts;
    }
    else
        return 'nav-'.basename($item->url);
    }
    add_filter( 'nav_menu_item_id', 'nav_id_filter', 10, 2 );
    
    function get_attachment_id_from_src ($image_src) {

        global $wpdb;
        $query = "SELECT ID FROM {$wpdb->posts} WHERE guid='$image_src'";
        $id = $wpdb->get_var($query);
        return $id;
    }
    
    //FUNCTION TO GET SLUG PASSING AN ID
    function the_slug( $id ) {
        $post_data = get_post($id, ARRAY_A);
        $slug = $post_data['post_name'];
        return $slug; 
    }

    function prk_get_image_caption ($int_id) {
        $thumbnail_image = get_posts(array('p' => $int_id, 'post_type' => 'attachment'));
        return $thumbnail_image[0]->post_excerpt;
    }
    function _remove_script_version( $src ){
        $parts = explode( '?', $src );
        return $parts[0];
    }
    //WRNGS REMOVAL
    add_theme_support( 'automatic-feed-links' );

    